# Research Notes - January 29, 2026

## Production Script Development

### Objective
Transfer validated enumeration workflow from Jupyter notebook to production script with batch processing capability.

### Completed Tasks

#### 1. Production Script Refactoring (`enumerate_macrocycles.py`)
Transferred all logic from `test_enumeration.ipynb` into clean, production-ready script:

**Core Functions:**
- `load_building_blocks()` - Loads Master_Building_Blocks_Cleaned.csv with whitespace stripping
- `get_building_block()` - Lookup function by monomer name (handles whitespace issues)
- `couple_amide()` - Sequential Schotten-Baumann amide coupling, returns SMILES and mol object
- `macrocyclize()` - Dibromo linker cyclization connecting cysteine thiols
- `enumerate_macrocycle()` - Main orchestration: 6-step coupling → macrocyclization with error handling
- `batch_enumerate_from_csv()` - Process multiple enumerations from input instruction CSV

#### 2. Input CSV Integration
Added support for batch enumeration from external instruction CSV:
- Input file: `34_Hit_values_extracted.csv`
- Columns used: `Reactant_Value_1`, `Reactant_Value_2`, `Reactant_Value_3`, `Reactant_Value_4`
- Automatically constructs building block sequences (e.g., 1,8,9,2 → X1_1, X2_8, X3_9, X4_2)
- Fixed terminals: Amino-Cys (N-terminus) and 4-PA-Cysteine (C-terminus)

#### 3. Workflow Optimization
Streamlined execution flow:
1. **Example enumeration** - Single test case (X1_1, X2_1, X3_1, X4_1) with detailed output
2. **Batch enumeration** - Process all 34 hits from input CSV
3. **Summary report** - Success/failure tally, timestamped CSV output

#### 4. Batch Enumeration Testing
Successfully enumerated all 34 macrocycles:
- ✓ 34/34 successful enumerations
- Output: `batch_enumeration_20260129_212919.csv`
- All linear peptides correctly assembled
- All macrocyclizations successful with o-dibromoxylene linker

### Output Structure
**CSV Columns:**
- `Hit_Index` - Original hit number from input
- `X1_Value`, `X2_Value`, `X3_Value`, `X4_Value` - Building block indices
- `Building_Block_Sequence` - Human-readable sequence (Amino-Cys → X1_n → X2_n → X3_n → X4_n → 4-PA-Cysteine)
- `Linear_SMILES` - Hexapeptide precursor SMILES
- `Cyclic_SMILES` - Final macrocycle SMILES
- `Success` - Boolean enumeration status
- `Error` - Error message if failed (all None in current run)

### Repository Updates
Committed and pushed to GitHub:
- Commit: "Add batch enumeration functionality from input CSV" (ddd0276)
- Files updated: `enumerate_macrocycles.py`

### Technical Notes
- All 50 building blocks validated in Master_Building_Blocks_Cleaned.csv
- Coupling order: primary amine couples to carboxylic acid
- Macrocyclization: o-dibromoxylene (C1=CC=C(C(=C1)CBr)CBr) reacts with both cysteine thiols
- SMIRKS pattern for amide coupling: `[C;$(C=O):1][OH1].[N;$(N[#6]);!$(N=*);!$([N-]);!$(N#*);!$([ND3]);!$([ND4]);!$(N[O,N]);!$(N[C,S]=[S,O,N]):2]>>[C:1][N+0:2]`

### Next Steps
- Potential: Add command-line arguments for flexible input CSV selection
- Potential: Structure visualization/rendering of enumerated macrocycles
- Potential: Property calculation (MW, cLogP, TPSA) for enumerated products
